<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CA Expense Tracker</title>
        <meta name="description" content="BMG">
        <meta name="keywords" content="BMG Netting">
        <link rel="stylesheet" href="css/foundation.css">
        <link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <script src="js/modernizr.js"></script>
        <meta class="foundation-data-attribute-namespace">
        <meta class="foundation-mq-xxlarge">
        <meta class="foundation-mq-xlarge">
        <meta class="foundation-mq-large">
        <meta class="foundation-mq-medium">
        <meta class="foundation-mq-small">
        <meta class="foundation-mq-topbar">

        <link rel="stylesheet" href="css/respond.css">
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.js"></script>

    </head>
    <body ng-app="myApp" ng-controller="admincontroller">
        <div class="header">
            <div class="row">
                <nav class="top-bar foundation-bar" data-topbar>
                    <ul class="title-area">
                        <li class="name">
                            <span>
                                <h1><b><a href="#!alog"><img src="images/CA_White_transparent_logo.png" width="50" height="50" /> &nbsp;&nbsp;&nbsp;&nbsp;EXPENSE TRACKER</a></b></h1>
                            </span>
                        </li>
                        <li class="toggle-topbar menu-icon"><a href="#"><span>menu</span></a></li>
                    </ul>
                    <section class="top-bar-section">
                        <ul class="right">
                            <li class="active"><a href="#!alog"><i class="fa fa-home fa-lg"></i></a></li>
                            <li><a href="#!bud">Budget</a></li>
                            <li><a href="#!cat">Category</a></li>
                            <li><a href="#!exp">Expense</a></li>
                            <li><a href="#!user">User</a></li>
                            <li><a href="#!rep">Reports</a></li>
                            <li><a href="#!chgpwd">Change Password</a></li> 
                            <li><a href="#!expTbl">View Expenses</a></li>
                            <li><a href="/logout">Logout</a></li>


                        </ul>
                    </section>
                </nav>
            </div>
        </div>
        <!-- Featured Section -->
        <div class="row contentdiv">
            <div class="small-12 columns" >
                <div ng-view></div>
            </div>
        </div>
        <div class="footer">
            <div class="row">
                <div class="large-12 columns">
                    <div class="row">
                        <div class="medium-6 columns">
                            <p class="pad1">&copy; 2015 BMG Netting Tool. All rights reserved.</p>
                        </div>
                        <div class="small-12 medium-6 columns">
                            <ul class="inline-list right pad1">
                                <li><a href="#"><i class="fa fa-rss fa-2x"></i></a></li>
                                <li><a href="https://www.facebook.com/CATechnologies"><i class="fa fa-facebook fa-2x"></i></a></li>
                                <li><a href="http://twitter.com/CAInc"><i class="fa fa-twitter fa-2x"></i></a></li>
                                <li><a href="https://plus.google.com/+CATechnologies"><i class="fa fa-google-plus fa-2x"></i></a></li>
                                <li><a href="#"><i class="fa fa-instagram fa-2x"></i></a></li>
                                <li><a href="#"><i class="fa fa-pinterest fa-2x"></i></a></li>
                            </ul>
                        </div>
                        <div class="small-12 columns">
                            <p class="text-right">&nbsp;x</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="js/jquery-1.8.3.js"></script>
        <script src="js/foundation.min.js"></script>
        <script>
            $(document).foundation();
        </script>
        <script>
            var app = angular.module("myApp", ["ngRoute"]);
            app.config(function($routeProvider) {
                $routeProvider
                .when("/alog", {
                    templateUrl : "/adminHome",
                })
                .when("/cat", {
                    templateUrl : "/addcategory",
                    controller: 'catcontroller'
                })
                .when("/chgpwd", {
                    templateUrl : "/changepwd",
                    controller : 'passcontroller'
                }) 
                .when("/exp", {
                    templateUrl : "/addexpense",
                    controller: 'expcontroller'
                })
                .when("/bud", {
                    templateUrl : "/addbudget",
                    controller: 'validateCtrl'
                })
                .when("/rep", {
                    templateUrl : "/newreport",
                    controller: 'reportcontroller'
                })
                .when("/user", {
                    templateUrl : "/adduser",
                    controller: 'usercontroller'
                })
                .when("/expTbl",{
                	templateUrl : "/getexptbl",
                	controller : 'exptblcontroller'
                });
            });



            app.controller('reportcontroller', function($scope,$http) {
              
            // $scope.addreport = function(){
            //       console.log($scope.date);
            //         var data = {
            //             date1 : $scope.date1,
            //             date2 : $scope.date2
            //         };
            //         $http.post('/report',data).then(function(response) {
            //             console.log(response.data.cname);
            //             $scope.cname = response.data.cname;
            //             $scope.fy = response.data.fy;
            //             $scope.ib = response.data.ib;
            //             $scope.rb = response.data.rb;
            //             $scope.q1 = response.data.q1;
            //             $scope.q2 = response.data.q2;
            //             $scope.q3 = response.data.q3;
            //             $scope.q4 = response.data.q4;

            //         });
            //     }
                    $scope.addreport=function(){
                        $http({
                            url:"/report",
                            method: "POST",
                            dataType:'json',
                            data:{
                                date1 : $scope.date1,
                                date2 : $scope.date2
                            },
                             headers: {
                          "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
                        }

                        }).then(function(response){
                            console.log(response.data.cname);
                            $scope.cname = response.data.cname;
                            $scope.fy = response.data.fy;
                            $scope.ib = response.data.ib;
                            $scope.rb = response.data.rb;
                            $scope.q1 = response.data.q1;
                            $scope.q2 = response.data.q2;
                            $scope.q3 = response.data.q3;
                            $scope.q4 = response.data.q4;
                        },function(response){
                        console.log(response.data);
                    });
                    }
                    
            });

			app.controller('exptblcontroller', function($scope,$http){
				$http.get('/getexpenses')
				.then(function(response){
					$scope.expenses = response.data;
				});
				
				$scope.deleteExp = function(id){
					console.log(id);
					$http({
                        url : "/delexpense",
                        method : "POST",
                        dataType: 'json',
                        data : {
                        	expenseId : id
                        },
                        headers: {
                          "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
                        }
                    }).then(function(response){
                        console.log("successful");
                    },function(response){
                        console.log(response.data);
                    });
				}
			});
			

            app.controller('catcontroller', function($scope,$http) {
            	$http.get('/financialYear')
                .then(function(response){

                       $scope.years = response.data;
          		});
            	
            	$scope.dateRange=function(fyyear){
            		console.log(fyyear);
            		var yearSplit = fyyear.split("Y");
            		var yearNumber = parseInt(yearSplit[1])-1;
            		$scope.min = "20"+yearNumber+"-04-01";
            		$scope.max = "20"+(yearNumber+1)+"-03-31";
            		console.log("min:"+$scope.min);
            		console.log("max:"+$scope.max);
            	}

            	$scope.checkQ = function(myForm){
            		var q1 = parseInt($scope.q1);
            		var q2 = parseInt($scope.q2);
            		var q3 = parseInt($scope.q3);
            		var q4 = parseInt($scope.q4);
            		var budget = $scope.budget;
            		var total = q1+q2+q3+q4;
            		console.log(total);
            		console.log(budget);
            		myForm.q1.$setValidity('budgetVerify',budget === total);
            		//console.log("f1:"+f1);
            		myForm.q2.$setValidity('budgetVerify',budget === total);
            		myForm.q3.$setValidity('budgetVerify',budget === total);
            		myForm.q4.$setValidity('budgetVerify',budget === total);
            			
            	}

                $scope.addcat=function(){
                    //console.log($scope.date);
                   // console.log('before calling ' + $scope.category);
                    $http({
                        url : "/category",
                        method : "POST",
                        dataType: 'json',
                        data : {
                            category: $scope.category,
                            budget: $scope.budget,
                            year: $scope.year,
                             date: $scope.date,
                            q1: $scope.q1,
                            q2: $scope.q2,
                            q3: $scope.q3,
                            q4: $scope.q4
                           
                            
                        },
                        headers: {
                          "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
                        }
                    }).then(function(response){
                        console.log("successful");
                    },function(response){
                        console.log(response.data);
                    });
                }



            });
            app.controller('usercontroller', function($scope,$http) {

                     $scope.addus=function(){
                    
                    $http({
                        url : "/newuser",
                        method : "POST",
                        dataType: 'json',
                        data : {
                            email: $scope.email,
                            user: $scope.user,
                            userrole: $scope.userrole
                        },
                        headers: {
                          "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
                        }
                    }).then(function(response){
                        console.log("successful");
                    },function(response){
                        console.log("response.data");
                    });
                }


            });

            app.controller('passcontroller', function($scope,$http,$window) {
                $scope.validate = function(myForm){
                    var val1 = $scope.newpwd;
                    var val2 = $scope.confpwd;
                    myForm.confpwd.$setValidity('passwordVerify', val1 === val2);
                }
                $scope.pwdCheck = function(){
                    $http({
                        url: "/checkPwd",
                        method: "PUT",
                        dataType: "json",
                        data:{
                            password : $scope.oldpwd,
                            newpassword : $scope.newpwd
                        },
                        headers:{
                            "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
                        }
                    }).then(function(response){
                            //$window.alert(response.data);
                            alert(response.data);
                        },function(response){
                            console.log("response.data");
                    });
                }
            });

            app.controller('admincontroller', function($scope) {
                // $scope.message="Welcome Admin";
                window.location.href = '#!/alog';
            });
            app.controller('validateCtrl', function($scope,$http) {
                 $scope.addbud=function(){
                    //console.log($scope.date);
                    //console.log('before calling ' + $scope.category);
                    $http({
                        url : "/budget",
                        method : "POST",
                        dataType: 'json',
                        data : {
                            year: $scope.year,
                           
                            date: $scope.date,
                            
                            budget: $scope.budget
                        },
                        headers: {
                          "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
                        }
                    }).then(function(response){
                        console.log("successful");
                    },function(response){
                        console.log("response.data");
                    });
                }
            });
            app.controller('expcontroller', function($scope,$http) {
                $http.get('/financialYear')
                .then(function(response){
                    $scope.years = response.data;
                });
                
                
                $scope.selectFun = function(){
                    console.log($scope.FYear);
                    var yearSplit = $scope.FYear.split("Y");
            		var yearNumber = parseInt(yearSplit[1])-1;
            		$scope.min = "20"+yearNumber+"-04-01";
            		$scope.max = "20"+(yearNumber+1)+"-03-31";
            		console.log("min:"+$scope.min);
            		console.log("max:"+$scope.max);

                    var data = {year : $scope.FYear};
                    var url = '/getcategory?year='+$scope.FYear;
                   $http.get(url).then(function(response){
                         $scope.names = response.data;
                    });
                }
                // $scope.addexp = function(){
                //   var data = {
                //     category: $scope.category,
                //     vendor: $scope.vendor,
                //     date: $scope.date,
                //     description: $scope.desc,
                //     amount: $scope.amount
                //   }
                //   console.log(JSON.stringify(data));
                //   //$http.defaults.headers.post["Content-Type"] = "application/x-www-form-urlencoded";
                //   $http.post("/expenses",data)
                //   .then(function(response){
                //     console.log("successful");
                //   },function(response){
                //     console.log("failure");
                //   });
                // }
                $scope.addexp=function(){
                    console.log($scope.date);
                    console.log('before calling ' + $scope.category);
                    $http({
                        url : "/expenses",
                        method : "POST",
                        dataType: 'json',
                        data : {
                            category: $scope.category,
                            vendor: $scope.vendor,
                            date: $scope.date,
                            description: $scope.desc,
                            amount: $scope.amount
                        },
                        headers: {
                          "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
                        }
                    }).then(function(response){
                        console.log("successful");
                    },function(response){
                        console.log("response.data");
                    });
                }
              });
        </script>
    </body>
</html>
